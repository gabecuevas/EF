var Ne=Object.defineProperty;var Pe=(e,t,n)=>t in e?Ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var W=(e,t,n)=>(Pe(e,typeof t!="symbol"?t+"":t,n),n);import{e as de,f as ue,h as x,a2 as ge,t as Ie,p as Ae,j as H,v as z,l as V,n as J,w as G,ac as M,x as pe,aj as fe,k as C,B as $,P as Re,aw as ke,r as X,a4 as ze,z as Me,a_ as Le,ar as Q,ao as ee,Q as Be,aq as je,ag as He,bF as B,bG as A,bN as te,b1 as De,bO as Fe,bP as ne,aC as We,D as Ue,o as ve,d as me,aE as Ge,aF as Xe,I as P,b3 as U,K as oe,H as ae,aX as Ye,aY as qe}from"./permission.js";import{a as Ve,e as Je}from"./index14.js";import{r as Ke}from"./responsiveObserve.js";import{R as Ze,m as Qe,P as et,t as tt,_ as nt,n as ot}from"./index11.js";import{i as at,o as rt,c as st}from"./index9.js";import{i as it}from"./styleChecker.js";const lt=e=>{const{antCls:t,componentCls:n,iconCls:o,avatarBg:a,avatarColor:m,containerSize:r,containerSizeLG:l,containerSizeSM:c,textFontSize:d,textFontSizeLG:g,textFontSizeSM:h,borderRadius:s,borderRadiusLG:i,borderRadiusSM:f,lineWidth:S,lineType:y}=e,u=(v,p,b)=>({width:v,height:v,lineHeight:`${v-S*2}px`,borderRadius:"50%",[`&${n}-square`]:{borderRadius:b},[`${n}-string`]:{position:"absolute",left:{_skip_check_:!0,value:"50%"},transformOrigin:"0 center"},[`&${n}-icon`]:{fontSize:p,[`> ${o}`]:{margin:0}}});return{[n]:x(x(x(x({},ge(e)),{position:"relative",display:"inline-block",overflow:"hidden",color:m,whiteSpace:"nowrap",textAlign:"center",verticalAlign:"middle",background:a,border:`${S}px ${y} transparent`,"&-image":{background:"transparent"},[`${t}-image-img`]:{display:"block"}}),u(r,d,s)),{"&-lg":x({},u(l,g,i)),"&-sm":x({},u(c,h,f)),"> img":{display:"block",width:"100%",height:"100%",objectFit:"cover"}})}},ct=e=>{const{componentCls:t,groupBorderColor:n,groupOverlapping:o,groupSpace:a}=e;return{[`${t}-group`]:{display:"inline-flex",[`${t}`]:{borderColor:n},"> *:not(:first-child)":{marginInlineStart:o}},[`${t}-group-popover`]:{[`${t} + ${t}`]:{marginInlineStart:a}}}},he=de("Avatar",e=>{const{colorTextLightSolid:t,colorTextPlaceholder:n}=e,o=ue(e,{avatarBg:n,avatarColor:t});return[lt(o),ct(o)]},e=>{const{controlHeight:t,controlHeightLG:n,controlHeightSM:o,fontSize:a,fontSizeLG:m,fontSizeXL:r,fontSizeHeading3:l,marginXS:c,marginXXS:d,colorBorderBg:g}=e;return{containerSize:t,containerSizeLG:n,containerSizeSM:o,textFontSize:Math.round((m+r)/2),textFontSizeLG:l,textFontSizeSM:a,groupSpace:d,groupOverlapping:-c,groupBorderColor:g}}),Se=Symbol("AvatarContextKey"),dt=()=>Ie(Se,{}),ut=e=>Ae(Se,e),gt=()=>({prefixCls:String,shape:{type:String,default:"circle"},size:{type:[Number,String,Object],default:()=>"default"},src:String,srcset:String,icon:Re.any,alt:String,gap:Number,draggable:{type:Boolean,default:void 0},crossOrigin:String,loadError:{type:Function}}),pt=H({compatConfig:{MODE:3},name:"AAvatar",inheritAttrs:!1,props:gt(),slots:Object,setup(e,t){let{slots:n,attrs:o}=t;const a=z(!0),m=z(!1),r=z(1),l=z(null),c=z(null),{prefixCls:d}=V("avatar",e),[g,h]=he(d),s=dt(),i=J(()=>e.size==="default"?s.size:e.size),f=Ve(),S=Je(()=>{if(typeof e.size!="object")return;const p=Ke.find(T=>f.value[T]);return e.size[p]}),y=p=>S.value?{width:`${S.value}px`,height:`${S.value}px`,lineHeight:`${S.value}px`,fontSize:`${p?S.value/2:18}px`}:{},u=()=>{if(!l.value||!c.value)return;const p=l.value.offsetWidth,b=c.value.offsetWidth;if(p!==0&&b!==0){const{gap:T=4}=e;T*2<b&&(r.value=b-T*2<p?(b-T*2)/p:1)}},v=()=>{const{loadError:p}=e;(p==null?void 0:p())!==!1&&(a.value=!1)};return G(()=>e.src,()=>{M(()=>{a.value=!0,r.value=1})}),G(()=>e.gap,()=>{M(()=>{u()})}),pe(()=>{M(()=>{u(),m.value=!0})}),()=>{var p,b;const{shape:T,src:O,alt:N,srcset:E,draggable:xe,crossOrigin:Ce}=e,Oe=(p=s.shape)!==null&&p!==void 0?p:T,R=fe(n,e,"icon"),_=d.value,Ee={[`${o.class}`]:!!o.class,[_]:!0,[`${_}-lg`]:i.value==="large",[`${_}-sm`]:i.value==="small",[`${_}-${Oe}`]:!0,[`${_}-image`]:O&&a.value,[`${_}-icon`]:R,[h.value]:!0},we=typeof i.value=="number"?{width:`${i.value}px`,height:`${i.value}px`,lineHeight:`${i.value}px`,fontSize:R?`${i.value/2}px`:"18px"}:{},Z=(b=n.default)===null||b===void 0?void 0:b.call(n);let k;if(O&&a.value)k=C("img",{draggable:xe,src:O,srcset:E,onError:v,alt:N,crossorigin:Ce},null);else if(R)k=R;else if(m.value||r.value!==1){const F=`scale(${r.value}) translateX(-50%)`,$e={msTransform:F,WebkitTransform:F,transform:F},_e=typeof i.value=="number"?{lineHeight:`${i.value}px`}:{};k=C(Ze,{onResize:u},{default:()=>[C("span",{class:`${_}-string`,ref:l,style:x(x({},_e),$e)},[Z])]})}else k=C("span",{class:`${_}-string`,ref:l,style:{opacity:0}},[Z]);return g(C("span",$($({},o),{},{ref:c,class:Ee,style:[we,y(!!R),o.style]}),[k]))}}}),L=pt,ft=e=>{const{componentCls:t,popoverBg:n,popoverColor:o,width:a,fontWeightStrong:m,popoverPadding:r,boxShadowSecondary:l,colorTextHeading:c,borderRadiusLG:d,zIndexPopup:g,marginXS:h,colorBgElevated:s}=e;return[{[t]:x(x({},ge(e)),{position:"absolute",top:0,left:{_skip_check_:!0,value:0},zIndex:g,fontWeight:"normal",whiteSpace:"normal",textAlign:"start",cursor:"auto",userSelect:"text","--antd-arrow-background-color":s,"&-rtl":{direction:"rtl"},"&-hidden":{display:"none"},[`${t}-content`]:{position:"relative"},[`${t}-inner`]:{backgroundColor:n,backgroundClip:"padding-box",borderRadius:d,boxShadow:l,padding:r},[`${t}-title`]:{minWidth:a,marginBottom:h,color:c,fontWeight:m},[`${t}-inner-content`]:{color:o}})},Qe(e,{colorBg:"var(--antd-arrow-background-color)"}),{[`${t}-pure`]:{position:"relative",maxWidth:"none",[`${t}-content`]:{display:"inline-block"}}}]},vt=e=>{const{componentCls:t}=e;return{[t]:et.map(n=>{const o=e[`${n}-6`];return{[`&${t}-${n}`]:{"--antd-arrow-background-color":o,[`${t}-inner`]:{backgroundColor:o},[`${t}-arrow`]:{background:"transparent"}}}})}},mt=e=>{const{componentCls:t,lineWidth:n,lineType:o,colorSplit:a,paddingSM:m,controlHeight:r,fontSize:l,lineHeight:c,padding:d}=e,g=r-Math.round(l*c),h=g/2,s=g/2-n,i=d;return{[t]:{[`${t}-inner`]:{padding:0},[`${t}-title`]:{margin:0,padding:`${h}px ${i}px ${s}px`,borderBottom:`${n}px ${o} ${a}`},[`${t}-inner-content`]:{padding:`${m}px ${i}px`}}}},ht=de("Popover",e=>{const{colorBgElevated:t,colorText:n,wireframe:o}=e,a=ue(e,{popoverBg:t,popoverColor:n,popoverPadding:12});return[ft(a),vt(a),o&&mt(a),at(a,"zoom-big")]},e=>{let{zIndexPopupBase:t}=e;return{zIndexPopup:t+30,width:177}}),St=()=>x(x({},ot()),{content:Q(),title:Q()}),yt=H({compatConfig:{MODE:3},name:"APopover",inheritAttrs:!1,props:it(St(),x(x({},tt()),{trigger:"hover",placement:"top",mouseEnterDelay:.1,mouseLeaveDelay:.1})),setup(e,t){let{expose:n,slots:o,attrs:a}=t;const m=X();ze(e.visible===void 0),n({getPopupDomNode:()=>{var s,i;return(i=(s=m.value)===null||s===void 0?void 0:s.getPopupDomNode)===null||i===void 0?void 0:i.call(s)}});const{prefixCls:r,configProvider:l}=V("popover",e),[c,d]=ht(r),g=J(()=>l.getPrefixCls()),h=()=>{var s,i;const{title:f=ee((s=o.title)===null||s===void 0?void 0:s.call(o)),content:S=ee((i=o.content)===null||i===void 0?void 0:i.call(o))}=e,y=!!(Array.isArray(f)?f.length:f),u=!!(Array.isArray(S)?S.length:f);return!y&&!u?null:C(Be,null,[y&&C("div",{class:`${r.value}-title`},[f]),C("div",{class:`${r.value}-inner-content`},[S])])};return()=>{const s=Me(e.overlayClassName,d.value);return c(C(nt,$($($({},rt(e,["title","content"])),a),{},{prefixCls:r.value,ref:m,overlayClassName:s,transitionName:Le(g.value,"zoom-big",e.transitionName),"data-popover-inject":!0}),{title:h,default:o.default}))}}}),bt=ke(yt),Tt=()=>({prefixCls:String,maxCount:Number,maxStyle:{type:Object,default:void 0},maxPopoverPlacement:{type:String,default:"top"},maxPopoverTrigger:String,size:{type:[Number,String,Object],default:"default"},shape:{type:String,default:"circle"}}),xt=H({compatConfig:{MODE:3},name:"AAvatarGroup",inheritAttrs:!1,props:Tt(),setup(e,t){let{slots:n,attrs:o}=t;const{prefixCls:a,direction:m}=V("avatar",e),r=J(()=>`${a.value}-group`),[l,c]=he(a);return je(()=>{const d={size:e.size,shape:e.shape};ut(d)}),()=>{const{maxPopoverPlacement:d="top",maxCount:g,maxStyle:h,maxPopoverTrigger:s="hover",shape:i}=e,f={[r.value]:!0,[`${r.value}-rtl`]:m.value==="rtl",[`${o.class}`]:!!o.class,[c.value]:!0},S=fe(n,e),y=He(S).map((v,p)=>st(v,{key:`avatar-key-${p}`})),u=y.length;if(g&&g<u){const v=y.slice(0,g),p=y.slice(g,u);return v.push(C(bt,{key:"avatar-popover-key",content:p,trigger:s,placement:d,overlayClassName:`${r.value}-popover`},{default:()=>[C(L,{style:h,shape:i},{default:()=>[`+${u-g}`]})]})),l(C("div",$($({},o),{},{class:f,style:o.style}),[v]))}return l(C("div",$($({},o),{},{class:f,style:o.style}),[y]))}}}),Y=xt;L.Group=Y;L.install=function(e){return e.component(L.name,L),e.component(Y.name,Y),e};async function Ct(e,t){const n=e.getReader();let o;for(;!(o=await n.read()).done;)t(o.value)}function Ot(e){let t,n,o,a=!1;return function(r){t===void 0?(t=r,n=0,o=-1):t=wt(t,r);const l=t.length;let c=0;for(;n<l;){a&&(t[n]===10&&(c=++n),a=!1);let d=-1;for(;n<l&&d===-1;++n)switch(t[n]){case 58:o===-1&&(o=n-c);break;case 13:a=!0;case 10:d=n;break}if(d===-1)break;e(t.subarray(c,d),o),c=n,o=-1}c===l?t=void 0:c!==0&&(t=t.subarray(c),n-=c)}}function Et(e,t,n){let o=re();const a=new TextDecoder;return function(r,l){if(r.length===0)n==null||n(o),o=re();else if(l>0){const c=a.decode(r.subarray(0,l)),d=l+(r[l+1]===32?2:1),g=a.decode(r.subarray(d));switch(c){case"data":o.data=o.data?o.data+`
`+g:g;break;case"event":o.event=g;break;case"id":e(o.id=g);break;case"retry":const h=parseInt(g,10);isNaN(h)||t(o.retry=h);break}}}}function wt(e,t){const n=new Uint8Array(e.length+t.length);return n.set(e),n.set(t,e.length),n}function re(){return{data:"",event:"",id:"",retry:void 0}}var $t=globalThis&&globalThis.__rest||function(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var a=0,o=Object.getOwnPropertySymbols(e);a<o.length;a++)t.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(e,o[a])&&(n[o[a]]=e[o[a]]);return n};const q="text/event-stream",_t=1e3,se="last-event-id";function Nt(e,t){var{signal:n,headers:o,onopen:a,onmessage:m,onclose:r,onerror:l,openWhenHidden:c,fetch:d}=t,g=$t(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((h,s)=>{const i=Object.assign({},o);i.accept||(i.accept=q);let f;function S(){f.abort(),document.hidden||T()}c||document.addEventListener("visibilitychange",S);let y=_t,u=0;function v(){document.removeEventListener("visibilitychange",S),window.clearTimeout(u),f.abort()}n==null||n.addEventListener("abort",()=>{v(),h()});const p=d??window.fetch,b=a??Pt;async function T(){var O;f=new AbortController;try{const N=await p(e,Object.assign(Object.assign({},g),{headers:i,signal:f.signal}));await b(N),await Ct(N.body,Ot(Et(E=>{E?i[se]=E:delete i[se]},E=>{y=E},m))),r==null||r(),v(),h()}catch(N){if(!f.signal.aborted)try{const E=(O=l==null?void 0:l(N))!==null&&O!==void 0?O:y;window.clearTimeout(u),u=window.setTimeout(T,E)}catch(E){v(),s(E)}}}T()})}function Pt(e){const t=e.headers.get("content-type");if(!(t!=null&&t.startsWith(q)))throw new Error(`Expected content-type to be ${q}, Actual: ${t}`)}const It="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let ye=(e=21)=>{let t="",n=crypto.getRandomValues(new Uint8Array(e));for(;e--;)t+=It[n[e]&63];return t};const D={USER:"USER",ASSISTANT:"ASSISTANT",SYSTEM:"SYSTEM"},I={OPERATION:"OPERATION",ACTION:"ACTION",TEXT:"TEXT",NONE:"NONE"},en={SYNC_TO_CRM:"SYNC_TO_CRM",SYNC_TO_SALESFORCE:"SYNC_TO_SALESFORCE",SYNC_TO_GOOGLESHEETS:"SYNC_TO_GOOGLESHEETS",SYNC_TO_NOTION:"SYNC_TO_NOTION",SYNC_TO_HUBSPOT:"SYNC_TO_HUBSPOT",SUMMARIZE_USER_INFO:"SUMMARIZE_USER_INFO",FIND_EMAIL:"FIND_EMAIL",DOWNLOAD_USER_INFO_TO_EXCEL:"DOWNLOAD_USER_INFO_TO_EXCEL"},At={streaming:!1,loading:!1},Rt={streaming:!0,loading:!0},be={streaming:!1,loading:!1};function tn(e,t={}){const n=Object.assign({},At,t);return K(D.USER,e,n)}function nn(e,t={}){const n=Object.assign({},Rt,t);return K(D.ASSISTANT,e,n)}function on(e,t={}){const n=Object.assign({},be,t);return K(D.SYSTEM,e,n)}function an(e,t={},n={}){const o=Object.assign({},be,n);return kt(D.SYSTEM,e,t,o)}function K(e,t,n={}){return Object.assign({id:ye(),role:e,createTime:Date.now(),streaming:!0,loading:!0,content:{type:I.TEXT,text:t}},n)}function kt(e,t,n={},o={}){return o!=null&&o.content&&Reflect.deleteProperty(o,"content"),Object.assign({id:ye(),role:e,createTime:Date.now(),streaming:!1,loading:!1,content:{type:I.OPERATION,operation:t,data:n}},o)}let j;async function zt(){j=await Fe()}const ie={chat:"/api/chat/prediction",summarize:"/api/contact/summarize"},w=class w{isLoaded(){return w.loadings.every(t=>!t)}async chat(t){var y;const n=w.index++;w.loadings[n]=!0;const o=t.type||"chat",a=ie[o]||ie.chat,m=A+a+"?time="+Date.now();let r;j||await zt(),o=="chat"?r={...te,...j,question:t.message.content,chatSessionId:t.message.chatSessionId}:o==="summarize"&&(r={...te,...j,...t.message.data,chatSessionId:t.message.chatSessionId});const l=new AbortController;(y=t.onController)==null||y.call(t,l);let c="",d="",g=!1,h=I.TEXT,s=null;function i(u){var v;if(s){(v=t.onError)==null||v.call(t,new ne(s.code,s.message)),w.loadings[n]=!1,g=!0,s=null;return}g||(w.loadings[n]=!1,g=!0,t.onFinish(c+d,u))}function f(){i()}function S(){var u,v;if(g||l.signal.aborted){c+=d,console.log("[Response Animation] finished"),(c==null?void 0:c.length)===0&&h===I.TEXT&&((u=t.onError)==null||u.call(t,new ne(0,"empty response from server")));return}if(d.length>0){const p=Math.max(1,Math.round(d.length/60)),b=d.slice(0,p);c+=b,d=d.slice(p),(v=t.onUpdate)==null||v.call(t,c)}requestAnimationFrame(S)}S(),l.signal.onabort=f,Nt(m,{method:"POST",signal:l.signal,headers:{"Content-Type":"application/json"},body:JSON.stringify(r),onmessage:u=>{let v=u.data;typeof u.data=="string"&&(v=JSON.parse(v));const p=v||{};if(p.code===200){const T=p.data.message.content;if(h=T.type,p.data.finishReason==="CONTINUE"){if(h===I.TEXT){const O=T.text;d+=O||""}}else p.data.finishReason==="STOP"&&i(h===I.ACTION?T.action:void 0)}else s={code:p.code},i()},async onopen(u){s=null,console.log("[onopen]",u),u.status!==De.Success&&(s={code:u.status},i())},onerror(u){var v;throw w.loadings[n]=!1,console.log("[onerror]",u),(v=t.onError)==null||v.call(t,u),u},onclose(){console.log("[onclose]"),i()},openWhenHidden:!0})}};W(w,"loadings",[]),W(w,"index",0);let le=w;function rn(e){return B(A+"/api/chat/recommend_question",e)}function sn(e){return B(A+"/api/chat_session/get_or_create",e)}function ln(e){return B(A+"/api/chat_session/history",e,{})}function cn(e){return B(A+"/api/chat/history",e,{})}function dn(e){return B(A+"/api/chat/add_system_message",{role:e.role,content:e.content,chatSessionId:e.chatSessionId})}const un="/loading.svg";function Mt(e,t){const n=e.getBoundingClientRect();if(!t)return n.top>=0&&n.bottom<=window.innerHeight;const o=t.getBoundingClientRect();return n.top>=o.top&&n.bottom<=o.bottom}async function Lt(e){return await M(),e.value instanceof HTMLElement?e.value:e.value?document.querySelector(e.value):null}function ce(e){let t=`0px 0px ${e.distance}px 0px`;e.top&&(t=`${e.distance}px 0px 0px 0px`);const n=new IntersectionObserver(o=>{o[0].isIntersecting&&(e.firstload&&e.emit(),e.firstload=!0)},{root:e.parentEl,rootMargin:t});return n.observe(e.infiniteLoading.value),n}const Te=(e,t)=>{const n=e.__vccOpts||e;for(const[o,a]of t)n[o]=a;return n},Bt={},jt=e=>(Ye("data-v-d3e37633"),e=e(),qe(),e),Ht={class:"container"},Dt=jt(()=>P("div",{class:"spinner"},null,-1)),Ft=[Dt];function Wt(e,t){return ve(),me("div",Ht,Ft)}const Ut=Te(Bt,[["render",Wt],["__scopeId","data-v-d3e37633"]]),Gt={class:"state-error"},Xt=H({__name:"InfiniteLoading",props:{top:{type:Boolean,default:!1},target:{},distance:{default:0},identifier:{},firstload:{type:Boolean,default:!0},slots:{}},emits:["infinite"],setup(e,{emit:t}){const n=e;let o=null,a=0;const m=X(null),r=X(""),{top:l,firstload:c,distance:d}=n,{identifier:g,target:h}=We(n),s={infiniteLoading:m,top:l,firstload:c,distance:d,parentEl:null,emit(){a=(s.parentEl||document.documentElement).scrollHeight,i.loading(),t("infinite",i)}},i={loading(){r.value="loading"},async loaded(){r.value="loaded";const f=s.parentEl||document.documentElement;await M(),l&&(f.scrollTop=f.scrollHeight-a),Mt(m.value,s.parentEl)&&s.emit()},complete(){r.value="complete",o==null||o.disconnect()},error(){r.value="error"}};return G(g,()=>{o==null||o.disconnect(),o=ce(s)}),pe(async()=>{s.parentEl=await Lt(h),o=ce(s)}),Ue(()=>{o==null||o.disconnect()}),(f,S)=>(ve(),me("div",{ref_key:"infiniteLoading",ref:m,style:{"min-height":"1px"}},[Ge(P("div",null,[U(f.$slots,"spinner",{},()=>[C(Ut)],!0)],512),[[Xe,r.value=="loading"]]),r.value=="complete"?U(f.$slots,"complete",{key:0},()=>{var y;return[P("span",null,oe(((y=f.slots)==null?void 0:y.complete)||"No more results!"),1)]},!0):ae("",!0),r.value=="error"?U(f.$slots,"error",{key:1,retry:s.emit},()=>{var y;return[P("span",Gt,[P("span",null,oe(((y=f.slots)==null?void 0:y.error)||"Oops something went wrong!"),1),P("button",{class:"retry",onClick:S[0]||(S[0]=(...u)=>s.emit&&s.emit(...u))},"retry")])]},!0):ae("",!0)],512))}}),gn=Te(Xt,[["__scopeId","data-v-a7077831"]]);export{L as A,I as C,D as R,gn as W,dn as a,en as b,tn as c,nn as d,le as e,rn as f,ln as g,an as h,on as i,sn as j,cn as k,un as l};
